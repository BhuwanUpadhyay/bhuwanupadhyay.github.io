<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><title>Domain-Driven Design Building Blocks - CS | Blogs, FSQs, Tips &amp; Tricks, Notes</title><link rel="manifest" href="/manifest.json"><meta name="theme-color" content="#f7f7f7"><meta name="application-name" content="CS | Blogs, FSQs, Tips &amp; Tricks, Notes"><meta name="msapplication-TileImage" content="/img/favicon.ico"><meta name="msapplication-TileColor" content="#f7f7f7"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="CS | Blogs, FSQs, Tips &amp; Tricks, Notes"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="Domain-driven design (DDD), is an approach used to build systems that have a complex business domain."><meta property="og:type" content="blog"><meta property="og:title" content="Domain-Driven Design Building Blocks"><meta property="og:url" content="https://bhuwanupadhyay.github.io/2020/05/domain-driven-design-building-blocks/"><meta property="og:site_name" content="CS | Blogs, FSQs, Tips &amp; Tricks, Notes"><meta property="og:description" content="Domain-driven design (DDD), is an approach used to build systems that have a complex business domain."><meta property="og:locale" content="en_US"><meta property="og:image" content="https://raw.githubusercontent.com/BhuwanUpadhyay/ddd-building-blocks/master/assets/featured.png"><meta property="article:published_time" content="2020-05-02T09:38:26.000Z"><meta property="article:author" content="Bhuwan Prasad Upadhyay"><meta property="article:tag" content="value-object"><meta property="article:tag" content="entity"><meta property="article:tag" content="aggregate-root"><meta property="article:tag" content="repository"><meta property="article:tag" content="factory"><meta property="article:tag" content="domain-service"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="https://raw.githubusercontent.com/BhuwanUpadhyay/ddd-building-blocks/master/assets/featured.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://bhuwanupadhyay.github.io/2020/05/domain-driven-design-building-blocks/"},"headline":"Domain-Driven Design Building Blocks","image":["https://raw.githubusercontent.com/BhuwanUpadhyay/ddd-building-blocks/master/assets/featured.png"],"datePublished":"2020-05-02T09:38:26.000Z","author":{"@type":"Person","name":"Bhuwan Prasad Upadhyay"},"publisher":{"@type":"Organization","name":"CS | Blogs, FSQs, Tips & Tricks, Notes","logo":{"@type":"ImageObject","url":"https://bhuwanupadhyay.github.io/img/logo.png"}},"description":"Domain-driven design (DDD), is an approach used to build systems that have a complex business domain."}</script><link rel="canonical" href="https://bhuwanupadhyay.github.io/2020/05/domain-driven-design-building-blocks/"><link rel="icon" href="/img/favicon.ico"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.2/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/vs2015.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><script src="https://www.googletagmanager.com/gtag/js?id=UA-177390945-1" async></script><script>window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
    
        gtag('config', 'UA-177390945-1');</script><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.css"><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script><!--!--><!--!--><meta name="generator" content="Hexo 5.4.0"></head><body class="is-1-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.png" alt="CS | Blogs, FSQs, Tips &amp; Tricks, Notes" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="View on GitHub" href="https://github.com/bhuwanupadhyay"><i class="fab fa-github"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-12"><div class="card"><div class="card-image"><span class="image is-7by3"><img class="fill" src="https://raw.githubusercontent.com/BhuwanUpadhyay/ddd-building-blocks/master/assets/featured.png" alt="Domain-Driven Design Building Blocks"></span></div><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2020-05-02T09:38:26.000Z" title="5/2/2020, 9:38:26 AM">2020-05-02</time></span><span class="level-item"><a class="link-muted" href="/categories/Domain-Driven-Design/">Domain Driven Design</a></span><span class="level-item">9 minutes read (About 1315 words)</span></div></div><h1 class="title is-3 is-size-4-mobile">Domain-Driven Design Building Blocks</h1><div class="content"><p>Domain-driven design (DDD), is an approach used to build systems that have a complex business domain.</p>
<span id="more"></span>

<p>So you wouldn’t apply DDD to, say, infrastructure software or building routers, proxies, or caching layers, 
but instead to business software that solves real-world business problems.
It’s a great technique for separating the way the business is modeled from the plumbing code that ties it all together.
Separating these two in the software itself makes it easier to design, model, build and evolve an implementation over time.</p>
<p>In tactical DDD, the building blocks play an important role in how business is modeled into the code.
In this article, I will take you through the best available options for building blocks in object-oriented principles.</p>
<h2 id="Value-Object"><a href="#Value-Object" class="headerlink" title="Value Object"></a>Value Object</h2><blockquote>
<p>An object that represents a descriptive aspect of the domain with no conceptual identity is called a Value Object. Value Objects are instantiated to represent elements of the design that we care about only for what they are, not who or which they are.
— <strong>Eric Evans</strong></p>
</blockquote>
<p>In other words, value objects don’t have their own identity. The value object possess concept of structural equality 
— if two objects are equal then they have equivalent content. 
Also, If two value objects have the same set of attributes we can treat them interchangeably.</p>
<h3 id="Attributes"><a href="#Attributes" class="headerlink" title="Attributes"></a>Attributes</h3><ul>
<li>No Identity - value objects are identity-less.</li>
<li>Immutable - value object can be replaced by another value object with same content. To make sure, equality by structure for value object is by using Immutable design especially in multi-thread scenarios (immutable objects are threadsafe by design).  </li>
<li>Lifespan - can’t exist without a parent entity (should not have separate table in a database).</li>
<li>Business Constraints - value object is always valid (should need to validate business rules on creation). 
I always prefer to validate business constraints on the <code>constructor</code> for the value object.</li>
</ul>
<h3 id="Code-Example"><a href="#Code-Example" class="headerlink" title="Code Example"></a>Code Example</h3><p>Equality logic implementation for value object is very important to ensure they are equals by its content.
It’s too easy to forget to override <code>equals()</code> and <code>hashCode()</code> in the value object.
It’s very important to make sure all properties of value object should be part of equality logic. </p>
<p>To enforce equality logic for value object I used following class as a base class for every value object.  </p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">ValueObject</span> </span>{</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object o)</span></span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h2 id="Entity"><a href="#Entity" class="headerlink" title="Entity"></a>Entity</h2><blockquote>
<p>Many objects are not fundamentally defined by their attributes, but rather by a thread of continuity and identity.
— <strong>Eric Evans</strong></p>
</blockquote>
<p>The entity possess concept of identifier equality — Two instances of entity would be equal if they have the same identifiers. 
We can change everything related to an entity (except its identifier), and after modification also it remains the same entity.</p>
<h3 id="Code-Example-1"><a href="#Code-Example-1" class="headerlink" title="Code Example"></a>Code Example</h3><p>Identifier equality means that entity class has a field for an identifier. 
Following class can be used as a base class for entity class.</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Objects;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Entity</span>&lt;<span class="title">ID</span> <span class="keyword">extends</span> <span class="title">ValueObject</span>&gt; </span>{</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String ENTITY_ID_IS_REQUIRED = <span class="string">"EntityIdIsRequired"</span>;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> ID id;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">Entity</span><span class="params">(ID id)</span> </span>{</span><br><span class="line">    DomainAsserts.begin(id).notNull(DomainError.create(<span class="keyword">this</span>, ENTITY_ID_IS_REQUIRED)).end();</span><br><span class="line">    <span class="keyword">this</span>.id = id;</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> ID <span class="title">getId</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.id;</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object o)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span> == o) <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    <span class="keyword">if</span> (o == <span class="keyword">null</span> || <span class="keyword">this</span>.getClass() != o.getClass()) <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    Entity&lt;?&gt; entity = (Entity&lt;?&gt;) o;</span><br><span class="line">    <span class="keyword">return</span> Objects.equals(<span class="keyword">this</span>.id, entity.id);</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="keyword">return</span> Objects.hash(<span class="keyword">this</span>.id);</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h2 id="Domain-Event"><a href="#Domain-Event" class="headerlink" title="Domain Event"></a>Domain Event</h2><blockquote>
<p>The essence of a Domain Event is that you use it to capture things that can trigger a change to the state of the application you are developing.
— <strong>Martin Fowler</strong></p>
</blockquote>
<p>A domain event is, something that happened in the domain that you want notify to other parts of the same domain. 
The important benefit of domain events is that side effects can be expressed explicitly.</p>
<p><img src="https://raw.githubusercontent.com/BhuwanUpadhyay/ddd-building-blocks/master/assets/aggregate_transaction.png"></p>
<h3 id="Code-Example-2"><a href="#Code-Example-2" class="headerlink" title="Code Example"></a>Code Example</h3><p>According to nature side effects, the published domain event can be listened inside same bounded context or another bounded context.
Following class can be used as a base class for domain event.</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Objects;</span><br><span class="line"><span class="keyword">import</span> java.util.UUID;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">DomainEvent</span> </span>{</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> String eventId = UUID.randomUUID().toString();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> String eventClassName = getClass().getName();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> String domainEventType;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">DomainEvent</span><span class="params">(DomainEventType domainEventType)</span> </span>{</span><br><span class="line">    DomainAsserts.begin(domainEventType)</span><br><span class="line">        .notNull(DomainError.create(<span class="keyword">this</span>, <span class="string">"DomainEventTypeIsRequired"</span>))</span><br><span class="line">        .end();</span><br><span class="line">    <span class="keyword">this</span>.domainEventType = domainEventType.name();</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">getEventId</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="keyword">return</span> eventId;</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">getEventClassName</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="keyword">return</span> eventClassName;</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">private</span> String <span class="title">getDomainEventType</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="keyword">return</span> domainEventType;</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isInsideContext</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="keyword">return</span> Objects.equals(DomainEventType.BOTH.name(), <span class="keyword">this</span>.getDomainEventType())</span><br><span class="line">        || Objects.equals(DomainEventType.INSIDE.name(), <span class="keyword">this</span>.getDomainEventType());</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isOutsideContext</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="keyword">return</span> Objects.equals(DomainEventType.BOTH.name(), <span class="keyword">this</span>.getDomainEventType())</span><br><span class="line">        || Objects.equals(DomainEventType.OUTSIDE.name(), <span class="keyword">this</span>.getDomainEventType());</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">DomainEventType</span> </span>{</span><br><span class="line">    <span class="comment">/** Represents domain event is inside same bounded context only. */</span></span><br><span class="line">    INSIDE,</span><br><span class="line">    <span class="comment">/** Represents domain event is only for other bounded context. */</span></span><br><span class="line">    OUTSIDE,</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Represents domain event is available for both i.e. inside same bounded context and other</span></span><br><span class="line"><span class="comment">     * bounded context.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    BOTH</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h2 id="Aggregate-Root"><a href="#Aggregate-Root" class="headerlink" title="Aggregate Root"></a>Aggregate Root</h2><blockquote>
<p>An AGGREGATE is a cluster of associated objects that we treat as a unit for the purpose of data changes. Each aggregate has a root and a boundary.
— <strong>Eric Evans</strong></p>
</blockquote>
<ul>
<li>Group the entities and value objects into aggregates and define boundaries around each. </li>
<li>Control all access to the objects inside the boundary through the root. </li>
<li>Allow external objects to hold references to the root only. </li>
<li>Register domain events into the aggregate root. </li>
</ul>
<h3 id="Code-Example-3"><a href="#Code-Example-3" class="headerlink" title="Code Example"></a>Code Example</h3><p>The example of base class for aggregate root in my tactical ddd implementation as below.</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Collections;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AggregateRoot</span>&lt;<span class="title">ID</span> <span class="keyword">extends</span> <span class="title">ValueObject</span>&gt; <span class="keyword">extends</span> <span class="title">Entity</span>&lt;<span class="title">ID</span>&gt; </span>{</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">transient</span> List&lt;DomainEvent&gt; domainEvents = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">AggregateRoot</span><span class="params">(ID id)</span> </span>{</span><br><span class="line">    <span class="keyword">super</span>(id);</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Register domain event</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> event domain event</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">registerEvent</span><span class="params">(DomainEvent event)</span> </span>{</span><br><span class="line">    <span class="keyword">this</span>.domainEvents.add(event);</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="comment">/** Clear registered domain events. */</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">clearDomainEvents</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="keyword">this</span>.domainEvents.clear();</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="comment">/** <span class="doctag">@return</span> list of domain events */</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> List&lt;DomainEvent&gt; <span class="title">getDomainEvents</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="keyword">return</span> Collections.unmodifiableList(domainEvents);</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h2 id="Repositories"><a href="#Repositories" class="headerlink" title="Repositories"></a>Repositories</h2><p>A repository is a service that uses a global interface to provide access to all entities and value objects that are within a particular aggregate collection.</p>
<h3 id="Code-Example-4"><a href="#Code-Example-4" class="headerlink" title="Code Example"></a>Code Example</h3><p>From a repository, we have to publish all domain events when persist the aggregate root and then detached domain events from the aggregate root.
You can use following code to extend your domain repository in your project.</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Optional;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">DomainRepository</span>&lt;<span class="title">T</span> <span class="keyword">extends</span> <span class="title">AggregateRoot</span>&lt;<span class="title">ID</span>&gt;, <span class="title">ID</span> <span class="keyword">extends</span> <span class="title">ValueObject</span>&gt; </span>{</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> DomainEventPublisher publisher;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">protected</span> <span class="title">DomainRepository</span><span class="params">(DomainEventPublisher publisher)</span> </span>{</span><br><span class="line">    <span class="keyword">this</span>.publisher = publisher;</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> Optional&lt;T&gt; <span class="title">findOne</span><span class="params">(ID id)</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">(T entity)</span> </span>{</span><br><span class="line">    DomainAsserts.begin(entity).notNull(DomainError.create(<span class="keyword">this</span>, <span class="string">"EntityIsRequired"</span>)).end();</span><br><span class="line">    <span class="keyword">this</span>.persist(entity);</span><br><span class="line">    entity.getDomainEvents().forEach(publisher::publish);</span><br><span class="line">    entity.clearDomainEvents();</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">persist</span><span class="params">(T entity)</span></span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h2 id="Domain-Service"><a href="#Domain-Service" class="headerlink" title="Domain Service"></a>Domain Service</h2><blockquote>
<p>Some concepts from the domain aren’t natural to model as objects…a service tends to be named for an activity, rather than an entity — a verb rather than a noun.
— <strong>Eric Evans</strong></p>
</blockquote>
<p>A service that expresses a business logic that is not part of any Aggregate Root.</p>
<blockquote>
<p>When an operation does not conceptually belong to any object. Following the natural contours of the problem, you can implement these operations in services.
— <strong>Wikipedia</strong></p>
</blockquote>
<p>Some business rules don’t make sense to be part of an Aggregate.  If something is ‘outside’ an Aggregate, then it’s probably is a Domain Service.</p>
<h2 id="Factories"><a href="#Factories" class="headerlink" title="Factories"></a>Factories</h2><p>Factories are often used to create Aggregates.
Aggregates provide encapsulation and a consistent boundary around a group of objects.
Aggregates are important because they enforce the internal consistency of the object they are responsible for.</p>
<p>A Factory can be useful when creating a new Aggregate because it will encapsulate the knowledge required to create an Aggregate in a consistent state and with all invariants enforced.</p>
<p>You can find example on github: <a target="_blank" rel="noopener" href="https://github.com/bhuwanupadhyay/ddd-building-blocks"><i class="fab fa-github"></i> Source Code</a></p>
<script>
        document.querySelectorAll('.not-gallery-item')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script></div><div class="article-licensing box"><div class="licensing-title"><p>Domain-Driven Design Building Blocks</p><p><a href="https://bhuwanupadhyay.github.io/2020/05/domain-driven-design-building-blocks/">https://bhuwanupadhyay.github.io/2020/05/domain-driven-design-building-blocks/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>Author</h6><p>Bhuwan Prasad Upadhyay</p></div></div><div class="level-item is-narrow"><div><h6>Posted on</h6><p>2020-05-02</p></div></div><div class="level-item is-narrow"><div><h6>Licensed under</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="" rel="noopener" target="_blank" title="CC BY-NC-SA 4.0" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a></p></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/value-object/">value-object</a><a class="link-muted mr-2" rel="tag" href="/tags/entity/">entity</a><a class="link-muted mr-2" rel="tag" href="/tags/aggregate-root/">aggregate-root</a><a class="link-muted mr-2" rel="tag" href="/tags/repository/">repository</a><a class="link-muted mr-2" rel="tag" href="/tags/factory/">factory</a><a class="link-muted mr-2" rel="tag" href="/tags/domain-service/">domain-service</a></div><div class="sharethis-inline-share-buttons"></div><script src="//platform-api.sharethis.com/js/sharethis.js#property=612de0d0ffbeba0012edaa19&amp;product=inline-share-buttons" defer></script></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2020/05/safely-exchanging-information-across-microservices/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">Safely Exchanging Information Across Microservices</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2020/04/applying-semantic-versioning-with-git-repository/"><span class="level-item">Applying semantic versioning with git repository</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card"><div class="card-content"><h3 class="title is-5">Comments</h3><div id="disqus_thread"><noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div><script>var disqus_config = function () {
            this.page.url = 'https://bhuwanupadhyay.github.io/2020/05/domain-driven-design-building-blocks/';
            this.page.identifier = '2020/05/domain-driven-design-building-blocks/';
        };
        (function() {
            var d = document, s = d.createElement('script');  
            s.src = '//' + 'bhuwanupadhyay' + '.disqus.com/embed.js';
            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
        })();</script></div></div></div><!--!--><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.png" alt="CS | Blogs, FSQs, Tips &amp; Tricks, Notes" height="28"></a><p class="is-size-7"><span>&copy; 2021 Bhuwan Prasad Upadhyay</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="View on GitHub" href="https://github.com/bhuwanupadhyay"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "This website uses cookies to improve your experience.",
          dismiss: "Got it!",
          allow: "Allow cookies",
          deny: "Decline",
          link: "Learn more",
          policy: "Cookie Policy",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><div id="outdated"><h6>Your browser is out-of-date!</h6><p>Update your browser to view this website correctly.&amp;npsb;<a id="btnUpdateBrowser" href="http://outdatedbrowser.com/">Update my browser now </a></p><p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">×</a></p></div><script src="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.js" defer></script><script>window.addEventListener("load", function () {
            outdatedBrowser({
                bgColor: '#f25648',
                color: '#ffffff',
                lowerThan: 'object-fit' // display on IE11 or below
            });
        });</script><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script><!-- hexo injector body_end start -->
    <script>
    (() => {
        function switchTab() {
            if (!location.hash) {
              return;
            }
            Array
                .from(document.querySelectorAll('.tab-content'))
                .forEach($tab => {
                    $tab.classList.add('is-hidden');
                });
            Array
                .from(document.querySelectorAll('.tabs li'))
                .forEach($tab => {
                    $tab.classList.remove('is-active');
                });
            const $activeTab = document.querySelector(location.hash);
            if ($activeTab) {
                $activeTab.classList.remove('is-hidden');
            }
            const $tabMenu = document.querySelector(`a[href="${location.hash}"]`);
            if ($tabMenu) {
                $tabMenu.parentElement.classList.add('is-active');
            }
        }
        switchTab();
        window.addEventListener('hashchange', switchTab, false);
    })();
    </script>
    <!-- hexo injector body_end end --></body></html>